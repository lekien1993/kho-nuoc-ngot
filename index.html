<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω kho n∆∞·ªõc</title>
  <script type="module">
    // Firebase SDK imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyC4pUOS37SM01K2bqUWX-RB2qkDrD38Oww",
      authDomain: "khonuoc-8044c.firebaseapp.com",
      databaseURL: "https://khonuoc-8044c-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "khonuoc-8044c",
      storageBucket: "khonuoc-8044c.appspot.com",
      messagingSenderId: "585367282568",
      appId: "1:585367282568:web:f38a5816fdc70a59e2103d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db);

    // G·ª≠i th√¥ng b√°o Telegram
    function sendTelegramMessage(message) {
      const chatId = '460122343';
      const token = '8177155010:AAHRAOmIzD04aC1DoK2xekVv3l6NNjwoXRo';
      const url = `https://api.telegram.org/bot${token}/sendMessage`;

      fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chatId, text: message })
      });
    }

    // L∆∞u d·ªØ li·ªáu ki·ªÉm kho
    async function saveInventory() {
      const ten = document.getElementById("ten").value;
      const loai = document.getElementById("loai").value;
      const ton = parseInt(document.getElementById("ton").value);

      if (!ten || !loai || isNaN(ton)) {
        alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin.");
        return;
      }

      await push(ref(db, 'kho'), { ten, loai, ton, timestamp: Date.now() });

      if (ton < 10) {
        sendTelegramMessage(`‚ö†Ô∏è C·∫£nh b√°o: T·ªìn kho s·∫£n ph·∫©m "${ten}" c√≤n d∆∞·ªõi 10 (${ton}).`);
      }

      sendTelegramMessage(`‚úÖ Nh√¢n vi√™n ƒë√£ ho√†n t·∫•t ki·ªÉm kho cho s·∫£n ph·∫©m "${ten}".`);
      alert("ƒê√£ l∆∞u d·ªØ li·ªáu ki·ªÉm kho.");
    }

    // Tr√≠ch xu·∫•t log b√°n h√†ng t·ª´ Telegram (v√≠ d·ª• th·ªß c√¥ng)
    window.getHistoryLog = async function(date) {
      const snapshot = await get(child(dbRef, `banhang`));
      if (snapshot.exists()) {
        const data = snapshot.val();
        let msg = `üì¶ Log b√°n h√†ng ng√†y ${date}:\n`;
        for (let key in data) {
          if (data[key].date === date) {
            msg += `‚Ä¢ ${data[key].ten}: ${data[key].soluong} sp\n`;
          }
        }
        sendTelegramMessage(msg);
      } else {
        sendTelegramMessage(`‚ùóKh√¥ng c√≥ d·ªØ li·ªáu b√°n h√†ng ng√†y ${date}.`);
      }
    };
  </script>
</head>
<body>
  <h2>Qu·∫£n l√Ω t·ªìn kho</h2>
  <input id="ten" placeholder="T√™n s·∫£n ph·∫©m"><br>
  <input id="loai" placeholder="Lo·∫°i s·∫£n ph·∫©m"><br>
  <input id="ton" type="number" placeholder="T·ªìn kho"><br>
  <button onclick="saveInventory()">L∆∞u d·ªØ li·ªáu</button>
</body>
</html>
